// ==UserScript==
// @name         Play Candy Box
// @namespace    http://ribeirobreno.com.br/
// @version      0.18.1
// @updateURL    https://github.com/ribeirobreno/candy-box-player/raw/master/Play-Candy-Box.meta.js
// @downloadURL  https://github.com/ribeirobreno/candy-box-player/raw/master/Play-Candy-Box.user.js
// @description  Automate some tasks from the first Candy Box game.
// @author       Breno Ribeiro <ribeiro.breno@gmail.com>
// @match        https://candybox2.github.io/candybox/
// @grant        unsafeWindow
// @run-at       document-idle
// ==/UserScript==
!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t){!function(e,t){"use strict";function n(e){return t.getElementById(e)}var r=!1,o=5,i=36e3,l=t.createElement("div"),u=n("quest_button"),a=n("quest_destination"),c=n("eat");function f(e){e.dispatchEvent(new Event("click"))}function s(e){return e&&!e.disabled}function d(){return e.quest}function p(){return d().things||[]}function b(){var e=p(),t={},n=0,r=!0,o=!1,i=void 0;try{for(var l,u=e[Symbol.iterator]();!(r=(l=u.next()).done);r=!0)"mob"===(t=l.value).type&&(n+=t.hp||0)}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}function y(e,t){var n=p(),r={},o=!0,i=!1,l=void 0;try{for(var u,a=n[Symbol.iterator]();!(o=(u=a.next()).done);o=!0)if((r=u.value).type===t&&r.text===e)return!0}catch(e){i=!0,l=e}finally{try{o||null==a.return||a.return()}finally{if(i)throw l}}return!1}function m(){var e=p(),t=d().getCharacterIndex()+1;return e.length>t?e[t]:{}}function v(){return m().hp||0}function h(){return"mob"===m().type}function g(t){var n=e.potions;return n&&n.list&&n.list[t]&&n.list[t].nbrOwned?n.list[t].nbrOwned:0}function x(){return a&&a.options?a.options.length:0}function _(){return a?a.selectedIndex:-1}function S(){var e=p()[d().getCharacterIndex()];return e&&e.hp?e.hp:0}function w(){return d().getCharacterMaxHp()}function M(){return w()-S()}function I(){var t=e.farm;return t&&t.lollipopsPlanted?t.lollipopsPlanted:0}function O(){return(S()/w()*100).toFixed(3)+"% of "+w()+"<br>Quest: "+(_()+1)+"/"+x()+"<br>Mobs HP: "+b()+"<br>Runs left: "+o+"<br>Hut: "+(100*i/36e3).toFixed(3)+"%"}l.style='position:fixed;bottom:.5em;right:.5em;border:1px solid #080;background-color:#8F8;color:#030;padding:.125em .25em;text-align:center;font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,monospace;',l.innerHTML="Soon!",t.body.appendChild(l),setTimeout((function l(){if(s(u)&&a&&_()>-1&&((F=e.sword)&&"none"!=F.name))r&&(r=!1,S()?x()>_()+1&&--o<1&&(o=5,++a.selectedIndex):_()>0&&(a.selectedIndex=0,o+=5,w()<Number.MAX_SAFE_INTEGER/2&&c&&f(c))),f(u),r=!0;else{var p=t.querySelectorAll("#sword_with_button button"),O=n("plant_1_lp"),P=n("go_to_hut");if(p&&p.length&&p.forEach((function(e){s(e)&&f(e)})),(C=e.shop)&&C.shown)if(I()>=17402&&(g("fireScroll")<10||g("impInvocationScroll")<2&&((A=e.objects)&&A.list&&A.list.magicianHat.have))){var E=n("buy_scroll");s(E)&&"hidden"!==getComputedStyle(E,null).getPropertyValue("visibility")&&f(E)}else if(I()/17402<.6){var H=n("buy_10_lollipops");s(H)&&"hidden"!==getComputedStyle(H,null).getPropertyValue("visibility")&&f(H)}if(s(O)&&I()<17402&&f(O),P){(j=e.lollipops)&&j.nbrOwned>4e4&&i>0?--i:i=36e3,i<1&&f(P);var T=t.querySelectorAll("#map button");T&&T.length&&T.forEach((function(e){s(e)&&/^(Sword, better sword|Candies, faster candies) !.+/.test(e.innerHTML)&&f(e)}))}if(d().weAreQuestingRightNow){c&&h()&&(m().max_hp||0)>w()&&f(c);var q=t.querySelectorAll("#quest_potions button");q&&q.length&&q.forEach((function(e){if(s(e)){var t=e.innerHTML;/^Imp invocation scroll.+/.test(t)&&y("GHO","mob")&&!function(e){return y(e,"ally")}("IMP")?(f(e),o=1):(/^Fire scroll.+/.test(t)&&h()&&v()>100||/^Teleport scroll.+/.test(t)&&h()&&v()>S()&&M()>50||/^Health potion.+/.test(t)&&M()>50&&b()>=S())&&f(e)}}))}}var j,A,C,F;a&&_()<0&&(a.selectedIndex=0),setTimeout(l,1e3/60)}),1e3/60),requestAnimationFrame((function e(){l.innerHTML=O(),requestAnimationFrame(e)}))}(unsafeWindow,document)}]);