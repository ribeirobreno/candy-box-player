// ==UserScript==
// @name         Play Candy Box
// @namespace    http://ribeirobreno.com.br/
// @version      0.19.1
// @updateURL    https://github.com/ribeirobreno/candy-box-player/raw/master/Play-Candy-Box.meta.js
// @downloadURL  https://github.com/ribeirobreno/candy-box-player/raw/master/Play-Candy-Box.user.js
// @description  Automate some tasks from the first Candy Box game.
// @author       Breno Ribeiro <ribeiro.breno@gmail.com>
// @match        https://candybox2.github.io/candybox/
// @grant        unsafeWindow
// @run-at       document-idle
// ==/UserScript==
!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=0)}([function(t,e,n){t.exports=n(1)},function(t,e){!function(t,e){"use strict";function n(t){return e.getElementById(t)}function r(t){return e.querySelectorAll(t)||[]}var o=!1,i=5,u=36e3,l=0,a=e.createElement("div"),c=n("quest_button"),f=n("quest_destination"),s=n("eat");function d(t){t.dispatchEvent(new Event("click"))}function p(t){return t&&!t.disabled}function b(t){return t&&"hidden"!==getComputedStyle(t,null).getPropertyValue("visibility")}function y(){return t.quest}function m(){return y().things||[]}function v(){var t=m(),e={},n=0,r=!0,o=!1,i=void 0;try{for(var u,l=t[Symbol.iterator]();!(r=(u=l.next()).done);r=!0)"mob"===(e=u.value).type&&(n+=e.hp||0)}catch(t){o=!0,i=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw i}}return n}function h(t,e){var n=m(),r={},o=!0,i=!1,u=void 0;try{for(var l,a=n[Symbol.iterator]();!(o=(l=a.next()).done);o=!0)if((r=l.value).type===e&&r.text===t)return!0}catch(t){i=!0,u=t}finally{try{o||null==a.return||a.return()}finally{if(i)throw u}}return!1}function g(){var t=m(),e=y().getCharacterIndex()+1;return t.length>e?t[e]:{}}function x(){return g().hp||0}function _(){return"mob"===g().type}function w(e){var n=t.potions;return n&&n.list&&n.list[e]&&n.list[e].nbrOwned?n.list[e].nbrOwned:0}function S(){return f&&f.options?f.options.length:0}function M(){return f?f.selectedIndex:-1}function I(){var t=m()[y().getCharacterIndex()];return t&&t.hp?t.hp:0}function O(){return y().getCharacterMaxHp()}function E(){return O()-I()}function H(){var e=t.farm;return e&&e.lollipopsPlanted?e.lollipopsPlanted:0}function P(){return(I()/O()*100).toFixed(3)+"% of "+O()+"<br>Quest: "+(M()+1)+"/"+S()+"<br>HP/Mobs: "+v()+"/"+l+"<br>Runs left: "+i+"<br>Hut: "+(100*u/36e3).toFixed(3)+"%"}a.style='position:fixed;bottom:.5em;right:.5em;border:1px solid #080;background-color:#8F8;color:#030;padding:.125em .25em;text-align:center;font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,monospace;',a.innerHTML="Soon!",e.body.appendChild(a),setTimeout((function e(){if(p(c)&&M()>-1&&((R=t.sword)&&"none"!=R.name))o&&(o=!1,I()?S()>M()+1&&--i<1&&(i=5,++f.selectedIndex):M()>0&&(f.selectedIndex=0,i+=5,O()<Number.MAX_SAFE_INTEGER/2&&s&&d(s))),d(c),o=!0;else{var a=r("#sword_with_button button"),P=n("plant_1_lp"),T=n("go_to_hut");if(a.forEach((function(t){p(t)&&d(t)})),(L=t.shop)&&L.shown)if(H()>=17402&&(w("fireScroll")<10||w("impInvocationScroll")<2&&((A=t.objects)&&A.list&&A.list.magicianHat.have))){var j=n("buy_scroll");p(j)&&b(j)&&d(j)}else if(H()/17402<.6){var F=n("buy_10_lollipops");p(F)&&b(F)&&d(F)}if(p(P)&&H()<17402&&d(P),T)(C=t.lollipops)&&C.nbrOwned>4e4&&u>0?--u:u=36e3,u<1&&d(T),r("#map button").forEach((function(t){p(t)&&/^(Sword, better sword|Candies, faster candies|Surpass yourself) .+/.test(t.innerHTML)&&d(t)}));if(y().weAreQuestingRightNow){s&&_()&&(g().max_hp||0)>O()&&d(s);var q=function(){var t=m(),e=0,n=!0,r=!1,o=void 0;try{for(var i,u=t[Symbol.iterator]();!(n=(i=u.next()).done);n=!0)"mob"===i.value.type&&++e}catch(t){r=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(r)throw o}}return e}();r("#quest_potions button").forEach((function(t){if(p(t)){var e=t.innerHTML;/^Imp invocation scroll.+/.test(e)&&h("GHO","mob")&&!function(t){return h(t,"ally")}("IMP")?(d(t),i=1):(/^Fire scroll.+/.test(e)&&_()&&x()>100||q<=l&&/^ Teleport scroll.+ /.test(e)&&_()&&x()>I()&&E()>50||/^Health potion.+/.test(e)&&E()>50&&v()>=I())&&d(t)}})),l=q}}var C,A,L,R;f&&M()<0&&(f.selectedIndex=0),setTimeout(e,1e3/60)}),1e3/60),requestAnimationFrame((function t(){a.innerHTML=P(),requestAnimationFrame(t)}))}(unsafeWindow,document)}]);